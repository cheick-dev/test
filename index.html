<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Démo de Partage d'Écran avec WebRTC</title>
	</head>
	<body>
		<h1>Démo de Partage d'Écran avec WebRTC</h1>

		<div>
			<button id="startButton">Commencer le partage d'écran</button>
		</div>

		<div id="localVideoContainer">
			<h2>Votre écran partagé</h2>
			<video id="localVideo" autoplay></video>
		</div>

		<div id="remoteVideoContainer">
			<h2>Écran partagé par l'autre utilisateur</h2>
			<video id="remoteVideo" autoplay></video>
		</div>

		<script>
			const startButton = document.getElementById("startButton");
			const localVideo = document.getElementById("localVideo");
			const remoteVideo = document.getElementById("remoteVideo");

			startButton.addEventListener("click", async () => {
				try {
					// Obtenir l'accès au partage d'écran
					const stream = await navigator.mediaDevices.getDisplayMedia(
						{ video: true }
					);

					// Afficher le partage d'écran local
					localVideo.srcObject = stream;

					// Créer une connexion WebRTC
					const peerConnection = new RTCPeerConnection();

					// Ajouter le partage d'écran local à la connexion
					stream.getTracks().forEach((track) => {
						peerConnection.addTrack(track, stream);
					});

					// Créer une offre de connexion
					const offer = await peerConnection.createOffer();
					await peerConnection.setLocalDescription(offer);

					// Envoyer l'offre à l'autre utilisateur (simulé ici)
					async function t() {
						// Simulez la réception de l'offre par l'autre utilisateur
						const receivedOffer = offer;

						// Créer une connexion WebRTC pour l'autre utilisateur
						const remotePeerConnection = new RTCPeerConnection();

						// Définir l'offre reçue comme description distante
						remotePeerConnection.setRemoteDescription(
							receivedOffer
						);

						// Créer une réponse à l'offre
						const answer =
							await remotePeerConnection.createAnswer();
						await remotePeerConnection.setLocalDescription(answer);

						// Simulez l'envoi de la réponse à l'autre utilisateur
						setTimeout(() => {
							// Simulez la réception de la réponse par l'utilisateur local
							const receivedAnswer = answer;

							// Définir la réponse reçue comme description distante
							peerConnection.setRemoteDescription(receivedAnswer);
						}, 2000);
					}
					setTimeout(t, 2000);
				} catch (error) {
					console.error("Erreur lors du partage d'écran :", error);
				}
			});
		</script>
	</body>
</html>
